<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 

	<title>Systo widget presenter</title> 

	<link type="text/css" rel="stylesheet" href="layout-default-latest.css" />

    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="jquery-ui.css"/>
    <link type="text/css" rel="stylesheet" href="jquery-ui-1.9.2.custom.css"/>

    <style>
#wrapper {
    background-color: #000;
    overflow:scroll;
    height: 470px;
    width: 500px;
    padding: 10px;
    
}

#workspace {
    position: relative;
    height: 10000px;
    width: 10000px;
}

.placeddiv {
    background-color: white;
    width: 400px;
    height: 300px;
    position: absolute;
}
    </style>

    <!-- Systo core - defines the SYSTO global variable and some core functions -->
    <script type="text/javascript" src="systo.js"></script>

    <!--script src="http://code.jquery.com/jquery-1.9.1.js"></script-->
    <!--script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script-->
    <script type="text/javascript" src="jquery-1.10.2.js"></script>
    <script type="text/javascript" src="jquery-ui-1.10.3.js"></script>
	<script type="text/javascript" src="jquery.layout-latest.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="formatting.js"></script>
    <script type="text/javascript" src="Blob.js"></script>
    <script type="text/javascript" src="FileSaver.js"></script>

    <!-- Supplementary Systo code -->
    <!--script type="text/javascript" src="generate_simulation_code_v1.js"></script-->
    <script type="text/javascript" src="simulation.js"></script>
    <script type="text/javascript" src="action.js"></script>
    <script type="text/javascript" src="compact.js"></script>
    <script type="text/javascript" src="equation.js"></script>
    <script type="text/javascript" src="functions.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/euler1.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/euler2.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/rk41.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/euler1animate.js"></script>


    <!-- A model language definition, held as a Javascript object literal -->
    <!--script type="text/javascript" src="languages/system_dynamics.js"></script-->
    <script type="text/javascript" src="languages/system_dynamics.js"></script>

    <!-- Model(s), held as a Javascript object literal -->
    <script type="text/javascript" src="models/miniworld.js"></script>
    <!--script type="text/javascript" src="models/miniworld_enum.js"></script-->
    <script type="text/javascript" src="models/predator_prey_shodor.js"></script>
    <script type="text/javascript" src="models/cascade.js"></script>
    <!--script type="text/javascript" src="models/speedy.js"></script-->
    <!--script type="text/javascript" src="models/fractal_triangle.js"></script-->
    <!--script type="text/javascript" src="models/fractal_fern.js"></script-->
    <!--script type="text/javascript" src="models/forest_cover_tipping_point.js"></script-->

    <!-- The widgets used in this page -->
	<script type="text/javascript" src="systo_widgets/jquery.audio_plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.auto_layout.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.compare_models_text.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.diagram.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.dialog_diagram_options.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.dialog_sd_node.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.equation_listing.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.import_im.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.import_vensim.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.import_xmile.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.inline_value.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.keypad.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.local_open.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.local_save.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.messages.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.multi_plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.multiple_sliders1.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.node_panel.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.phase_plane.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.runcontrol.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.sketchgraph.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.slider1.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.table.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.technical.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.template.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.text_plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.toolbar.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.tutorial.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.tutorial_step.js"></script>

    <!-- This page's custom script -->
    <script>

    $(document).ready(function() {
        var count = 0;

        SYSTO.switchToModel('miniworld');

        $("#workspace").mousedown(function(e){
            var wrapper = $('#workspace').parent();
            var parentOffset = wrapper.offset(); 
            var relX = e.pageX - parentOffset.left + wrapper.scrollLeft();
            var relY = e.pageY - parentOffset.top + wrapper.scrollTop()-20;
            console.debug(e.pageY+'; '+parentOffset.top+'; '+wrapper.scrollTop());
            
            var newDiv = $('<div/>')
                .addClass('placeddiv')
                .css({
                    left: relX,
                    top: relY
                });
            var handle = $('<div class="handle" style="height:20px; width:20px; background-color:yellow;"></div>');
            $(newDiv).append(handle);
            $('#workspace').append(newDiv);    
            $(newDiv).draggable({handle:handle}).resizable();
            $(newDiv).diagram({modelId:'miniworld'});
            $(newDiv).mousedown(function(ev) {
                ev.stopPropagation();
            });
        });

    });
	</script>

</head>
<body>

<div id="toolbar" style="width:100%;">
<select>
    <option>diagram</option>
    <option>plotter</option>
    <option>table</option>
    <option>sliders</option>
</select>
<select>
    <option>miniworld</option>
    <option>predator-prey</option>
    <option>cascade</option>
</select>
<button id="button">Add</button>
</div>

<div id="workspace" style="width:100%; height:600px; background-color:#f0f0ff;">
</div>

<script>
</script>
</body>
</html>
