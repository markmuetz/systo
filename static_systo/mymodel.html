<html>
<head>
    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="jquery-ui.css"/>
    <link type="text/css" rel="stylesheet" href="jquery-ui-1.9.2.custom.css"/>

    <!-- Systo core - defines the SYSTO global variable and some core functions -->
    <script type="text/javascript" src="systo.js"></script>

    <!-- Core libraries -->
    <script type="text/javascript" src="jquery-1.10.2.js"></script>
    <script type="text/javascript" src="jquery-ui-1.10.3.js"></script>
    <script type="text/javascript" src="formatting.js"></script>
    <script type="text/javascript" src="action.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.ui.widget.js"></script>

    <!-- Supplementary Systo code -->
    <script type="text/javascript" src="simulation.js"></script>
    <script type="text/javascript" src="action.js"></script>
    <script type="text/javascript" src="functions/codeGenerator/euler1.js"></script>

    <!-- A model language definition, held as a Javascript object literal -->
    <script type="text/javascript" src="languages/system_dynamics.js"></script>

    <!-- Model(s), held as a Javascript object literal -->
    <!-- No built-in models - model is provided as a URL query string -->
    <!-- http://pieroxy.net/blog/pages/lz-string/index.html -->

    <!-- The widgets used in this page -->
	<script type="text/javascript" src="systo_widgets/jquery.slider1.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.multiple_sliders1.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.diagram.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.inline_value.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.equation_listing.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.node_dialog_system_dynamics.js"></script>

    <!-- This page's custom script -->
    <script>

        $(document).ready(function() {

            var urlVars = SYSTO.getUrlVars();
            console.debug(urlVars);
            var modelBase64 = urlVars.base64;
            console.debug(modelBase64);
            var modelStr = window.atob(modelBase64);
            console.debug(modelStr);
            var model = JSON.parse(modelStr);
            SYSTO.models['mymodel'] = model;

            generateSimulationFunction(SYSTO.models['mymodel']);


            $('#diagram1').diagram({modelId:'mymodel', allowEditing:true});
            $('#diagram1').resizable();

            $('#plotter1').plotter({
                modelId:'mymodel',
                canvasWidth:400, 
                canvasHeight:250,
                selectNode:function (node) {
                    if (node.type === 'stock' && node.label !== 'TSUM') {
                        return true;
                    } else {
                        return false;
                    }
                }
            });

            $('#sliders_initialstock').multiplesliders1({
                modelId:'mymodel',
                selectNode:function (node) {
                    if (node.type === 'stock') {
                        return true;
                    } else {
                        return false;
                    }
                }
            });


            $('#sliders_parameter').multiplesliders1({
                modelId:'mymodel',
                selectNode:function (node) {
                    if (node.type==='variable' && isEmpty(node.inarcList)) {
                        return true;
                    } else {
                        return false;
                    }
                }
            });


            $('#equation_listing').equation_listing({modelId:'mymodel'});
            $('#node_dialogs').append(SYSTO.node_dialogs.system_dynamics);

         });
    </script>
</head>

<body style="font-family:arial,sans-serif;">
<div style="width:100%; background-color:yellow; border:2px solid red; font-size:22px; font-weight:bold;">This is a Systo demonstration page.<br/><span style="font-size:16px; font-weight:normal;">This one illustrates a 'live' page for one specific model.</span></div>
    <h2>mymodel</h2>
    <h3>Model description</h3>
    <p><a href="http://models.pps.wur.nl/content/mymodel-1-simple-crop-growth-model-simulate-growth-under-potential-growing-conditions">mymodel-1</a> is a simple model to simulate crop growth under potential growing conditions. This means that water and nutrient supply are assumed to be optimal and also the crop management.  Crop growth is calculated by assuming a simple relationship between the incoming solar radiation as intercepted by the crop canopy, and the crop growth<p>
    <div id="diagram1" style="float:left; margin:1px; width:700px; height:400px; margin-right:20px; border:solid 1px gray"></div>

    <div style="float:left;">
        <p>Plot of stocks</p>
        <div id='plotter1' style="float:left; position:relative; margin:1px; width:400px; height:300px;"></div>
    </div>
    <div style="float:left;">
        <div style="float:left;">
            <span>Sliders for setting the initial stock values</span>
            <div id="sliders_initialstock" style="padding:7px; margin:1px; width:420px;"></div>
        </div>
        <p>&nbsp;</p>
        <div style="clear:left;">
            <span>Sliders for setting parameter values</span>
            <div id="sliders_parameter" style="padding:7px; margin:1px; width:420px;"></div>
        </div>
       <p>&nbsp;</p>
       <p>&nbsp;</p>
    </div>

    <h3 style="clear:left;">Equations</h3>
    <div id="equation_listing"></div>

    <h3 style="clear:left;">Source</h3>
   <p>You can visit the <a href="http://models.pps.wur.nl/content/mymodel-1-simple-crop-growth-model-simulate-growth-under-potential-growing-conditions">mymodel-1 home page</a> for more information on mymodel, including documentation and class exercises..</p>
    <div id="node_dialogs"></div>

    <div id="dialog_sd_node"></div>
</body>
</html>


