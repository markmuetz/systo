<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 

	<title>Systo widget presenter</title> 

	<link type="text/css" rel="stylesheet" href="layout-default-latest.css" />

    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="jquery-ui.css"/>
    <link type="text/css" rel="stylesheet" href="jquery-ui-1.9.2.custom.css"/>

    <style>
    #widget_list_outer {
        float:left;
        font-size:14px;
        width:210px;
    }

    #widget_list {
        background-color:#eeffee;
        width:210px;
        height:400px;
        overflow-y:auto;
        overflow-x:hidden;
    }

    #widget_list_table {
        border-collapse: collapse;
        padding: 5px;
    }

    #widget_list_table td {
        padding-left: 5px;
        font-size:14px;
    }

    #table_all_widgets {
        border-collapse: collapse;
        padding: 5px;
    }

    #table_all_widgets td {
        border:1px #808080 solid;
        padding-left: 5px;
        font-size:14px;
    }

    #widget_display {
        margin-left:220px;
    }

    .optionId {
        font-weight:bold;
        font-size:16px;
    }

    .body {
        border:1px solid #c0c0c0;
        background:white;
        overflow:hidden;
        !height:420px;
    </style>

    <!-- Systo core - defines the SYSTO global variable and some core functions -->
    <script type="text/javascript" src="systo.js"></script>

    <!--script src="http://code.jquery.com/jquery-1.9.1.js"></script-->
    <!--script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script-->
    <script type="text/javascript" src="jquery-1.10.2.js"></script>
    <script type="text/javascript" src="jquery-ui-1.10.3.js"></script>
	<script type="text/javascript" src="jquery.layout-latest.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="formatting.js"></script>
    <script type="text/javascript" src="Blob.js"></script>
    <script type="text/javascript" src="FileSaver.js"></script>

    <!-- Supplementary Systo code -->
    <!--script type="text/javascript" src="generate_simulation_code_v1.js"></script-->
    <script type="text/javascript" src="simulation.js"></script>
    <script type="text/javascript" src="action.js"></script>
    <script type="text/javascript" src="compact.js"></script>
    <script type="text/javascript" src="equation.js"></script>
    <script type="text/javascript" src="functions.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/euler1.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/euler2.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/rk41.js"></script>
    <script type="text/javascript" src="plugins/codeGenerator/euler1animate.js"></script>


    <!-- A model language definition, held as a Javascript object literal -->
    <!--script type="text/javascript" src="languages/system_dynamics.js"></script-->
    <script type="text/javascript" src="languages/system_dynamics.js"></script>

    <!-- Model(s), held as a Javascript object literal -->
    <script type="text/javascript" src="models/miniworld.js"></script>
    <!--script type="text/javascript" src="models/miniworld_enum.js"></script-->
    <script type="text/javascript" src="models/predator_prey_shodor.js"></script>
    <script type="text/javascript" src="models/cascade.js"></script>
    <!--script type="text/javascript" src="models/speedy.js"></script-->
    <!--script type="text/javascript" src="models/fractal_triangle.js"></script-->
    <!--script type="text/javascript" src="models/fractal_fern.js"></script-->
    <!--script type="text/javascript" src="models/forest_cover_tipping_point.js"></script-->

    <!-- The widgets used in this page -->
	<script type="text/javascript" src="systo_widgets/jquery.audio_plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.auto_layout.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.compare_models_text.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.diagram.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.dialog_diagram_options.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.dialog_sd_node.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.equation_listing.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.import_im.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.import_vensim.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.import_xmile.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.inline_value.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.keypad.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.local_open.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.local_save.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.messages.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.multi_plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.multiple_sliders1.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.node_panel.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.phase_plane.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.runcontrol.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.sketchgraph.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.slider1.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.table.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.technical.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.template.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.text_plotter.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.toolbar.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.tutorial.js"></script>
	<script type="text/javascript" src="systo_widgets/jquery.tutorial_step.js"></script>

    <!-- This page's custom script -->
    <script>

    $(document).ready(function() {
        
        SYSTO.switchToModel('miniworld');

        var widgets = window.jQuery.systo;  // Cunning!   Must check that it never returns a non-widget.
        for (var widgetId in widgets) {
            if (widgets.hasOwnProperty(widgetId)) {
                var widget = widgets[widgetId];
                console.debug(widget);
                short_description = '...';
                if (widget._proto.meta) {
                    var meta = widget._proto.meta;
                    if (meta.short_description) {
                        var short_description = meta.short_description;
                    }
                }
                $('#widget_list_table').append(
                    '<tr>'+
                        '<td onclick="displayWidget(\''+widgetId+'\');" title="'+short_description+'">'+widgetId+'</td>'+
                    '</tr>');
            }
        }

        $('#widget_list').resizable();
    });
	</script>

</head>
<body>
<h1>Systo widget presenter</h1>

<div id="container" style="width:100%; max-height:100%">

    <div id="widget_list_outer">
        <button style="margin-bottom:10px;" onclick="tabulateAllWidgets();">Tabulate all widgets</button>
        <div>Click on a widget ID from the list below:</div>
        <div id="widget_list">
            <table id="widget_list_table"></table>
        </div>
    </div>

    <div id="widget_display">
<p>This page provides information on all the widgets available at <a href="http://www.systo.org">systo.org</a>.  It is intended as a reference for web page developers, and assumes that you are comfortable with HTML and a little Javascript.</p>
<p>In most cases, the widget is "live", which means that you can use it just as you would when the widget is used in a Systo web page.</p>
<p>This page is constructed dynamically, using information stored with the widget itself.  This avoids the need to have a separate documentation page for each widget, and reduces the risk of inconsistency between what the widget can do and the documentation of the widget.</p>
<p>However, because this page is built dynamically, it does mean that doing the usual "View source" is <u>not</u> a good way to see how to use the widgets.  Rather, go to the <a href="http://www.ssto.org/demos.html">Systo Demos area</a> to see fairly simple examples of the widgets in action.  A proper index of demo page(s) for each widget will be provided in due course.</p>
<p>To incorporate a widget in your web page, you generally:
<ul>
<li style="margin-bottom:5px;">Add a &lt;script&gt; element with a src attribute for this widget, e.g. <br/>
<span style="font-family:courier">&lt;script src="path/jquery.diagram.js"&gt;&lt;/script&gt;</span></li>
<li style="margin-bottom:5px;">Add a container element for the widget, usually an empty &lt;div&gt; element, with an id attribute, e.g. <br/>
<span style="font-family:courier">&lt;div id="diagram1"&gt;&lt;/div&gt;</span></li>
<li>Add a statement in the page's code to bind the widget to the element, e.g. <br/>
<span style="font-family:courier">$('#diagram1').diagram({modelId:'miniworld'});</span><br/>including any obligatory options plus any others you wish to set.</li>
</ul>
</div>

</div>

  <script>
    function tabulateAllWidgets() {
        var widgets = window.jQuery.systo;  
        $('#widget_display').empty();
        $('#widget_display').append('<table id="table_all_widgets"></table>');
        $('#table_all_widgets').append('<tr><td><b>Widget Id</b></td><td><b>Short description</b></td></tr>');
        for (var widgetId in widgets) {
            if (widgets.hasOwnProperty(widgetId)) {
                var widget = widgets[widgetId];
                short_description = '...';
                if (widget._proto.meta) {
                    var meta = widget._proto.meta;
                    if (meta.short_description) {
                        var short_description = meta.short_description;
                    }
                }
                $('#table_all_widgets').append(
                    '<tr>'+
                        '<td>'+widgetId+'</td><td>'+short_description+'</td>'+
                    '</tr>');
            }
        }
    }


    function displayWidget(widgetId) {
            $('#widget_display').empty();
            var widgets = window.jQuery.systo;
            var widget = widgets[widgetId];
            var meta = widget._proto.meta;
            $('#widget_display').append('<h2>'+widgetId+'</h2>');
            if (meta) {
                if (meta.short_description) {
                    $('#widget_display').append('<p>'+meta.short_description+'</p>');
                }
                
                $('#widget_display').append('<div id="widget_container_caption"><i>Example use: based on the model \'miniworld\'</i></div>');
                $('#widget_display').append('<div id="widget_container" class="body" style="position:relative"></div><br/>');

                $('.body').css({height:'auto', width:'auto', overflow:'auto'});
                if (meta.visible) {
                    console.debug(widgetId);
                    switch(widgetId) {

                        case 'audio_plotter':
                            $('.body').css({height:'auto', width:'250px'});
                            $('#widget_container').audio_plotter({
                                modelId:'miniworld',
                                includeNodeId: function(nodeId) {
                                    var node = SYSTO.models['miniworld'].nodes[nodeId];
                                    if (node.type === 'stock') {
                                        return true;
                                    } else {
                                        return false;
                                    }
                                }
                            });
                            break;

                        case 'diagram':
                            $('.body').css({height:'300px', width:'500px'});
                            $('#widget_container').diagram({modelId:'miniworld', allowEditing:false});
                            break;

                        case 'equation_listing':
                            $('.body').css({height:'320px', width:'auto', overflow:'auto'});
                            $('#widget_container').equation_listing({modelId:'miniworld'});
                            break;

                        case 'inlineValue':
                            $('#widget_container').append('<div>The final value for stock1 is '+
                                '<span id="inlineXXX" style="color:red;"></span><br/>'+
                                'The value in red is the result displayed by this widget.</div>');
                            $('#inlineXXX').inlineValue({modelId:'miniworld', nodeId:'stock1', statistic:'final'});
                            break;

                        case 'local_open':
                           $('#widget_container').local_open();
                            break;

                        case 'local_save':
                           $('#widget_container').local_save({modelId:'miniworld'});
                            break;

                        case 'messages':
                            $('#widget_container').messages();
                            SYSTO.trigger({
                                file: 'widget_presented.html', 
                                action: 'Displaying "messages" widget"', 
                                event_type: 'message_listener', 
                                parameters: {message: '<p style="color:blue">This is an example of a message sent to the <b>messages</b> widget.</p><p>You can actually send any HTML.</p>'}});
                            break;

                        case 'multi_plotter':
                            $('.body').css({height:'300px', width:'700px'});
                            $('#widget_container').multi_plotter({
                                modelId:'miniworld', 
                                active:true,
                            });
                            //SYSTO.simulate(model);
                            SYSTO.trigger(
                                file: 'widget_presenter.html',
                                action: 'Displaying "multi_plotter" widget',
                                event_type: 'change_model_listener',
                                parameters: {packageId:'package1', oldModelId:'', newModelId:'miniworld'}});
                            SYSTO.trigger(
                                file: 'widget_presenter.html',
                                action: 'Displaying "multi_plotter" widget',
                                event_type: 'display_listener',
                                parameters: {packageId:'package1', modelId:'miniworld'}});
                            break;

                        case 'multiplesliders1':
                            $('#widget_container').multiplesliders1({
                                modelId:'miniworld',
                                selectNode:function (node) {
                                    if (node.type==='variable' && isEmpty(node.inarcList)) {
                                        return true;
                                    } else {
                                        return false;
                                    }
                                }
                            });
                            break;

                        case 'phase_plane' :
                            $('.body').css({height:'400px', width:'400px'});
                            $('#widget_container').phase_plane({modelId:'miniworld', nodeIdx:'stock1', nodeIdy:'stock3'});
                            break;

                        case 'plotter':
                            $('.body').css({height:'340px', width:'550px'});
                            $('#widget_container').plotter({
                                modelId:'miniworld',
                                allowChangeOfModel: true,
                                canvasWidth:400, 
                                canvasHeight:250,
                                selectNode:function (node) {
                                    if (node.type === 'stock') {
                                        return true;
                                    } else {
                                        return false;
                                    }
                                }
                            });
                            break;

                        case 'runcontrol':
                            $('.body').css({height:'auto', width:'280px'});
                            $('#widget_container').runcontrol({modelId:'miniworld'});
                            break;

                        case 'sketchgraph':
                            $('.body').css({height:'320px', width:'650px'});
                            $('#widget_container').sketchgraph({
                                        modelId: 'miniworld',
                                        nodeIdx: 'stock5',
                                        nodeIdy: 'variable19'});
                            break;

                        case 'slider1':
                            $('#widget_container').slider1({
                                modelId:'miniworld', 
                                label:'birth_rate', 
                                value:0.5, 
                                minval:0, 
                                maxval:2});
                            break;

                        case 'table':
                            $('.body').css({height:'320px', width:'250px', overflow:'auto'});
                            $('#widget_container').table({modelId:'miniworld'});
                            break;

                        case 'technical':
                            $('.body').css({height:'320px', width:'auto'});
                            $('#widget_container_caption').html('<i>Please note: not all tabs have useful content in this live example.</i>');

                            $('#widget_container').technical();
                            $('.technical-1').css({display:'block'});
                            //$('.technical_listener').trigger('click');
                            SYSTO.trigger(
                                file: 'widget_presenter.html',
                                action: 'Displaying "technical" widget',
                                event_type: 'technical_listener',
                                parameters: {}});
                            break;

                        case 'text_plotter':
                            $('.body').css({'max-height':'320px', width:'auto', overflow:'auto'});
                            $('#widget_container').text_plotter({modelId:'miniworld'});
                            break;

                        case 'toolbar':
                            $('.body').css({'max-height':'320px', width:'200px', overflow:'auto'});
                            $('#widget_container').toolbar({
                                languageId:SYSTO.models.miniworld.meta.language,
                                modelId:'miniworld',
                                show_button_language:true,
                                show_button_new:true,
                                show_button_open:true,
                                show_button_save:true,
                                show_button_tutorial:true,
                                show_button_technical:true
                            });

                            break;

                        default: 
                            $('.body').css({'height':'auto', 'max-width':'400px'});
                            $('#widget_container_caption').html('');
                            $('#widget_container').html('<p><i>Example has not yet been implemented.</i></p>');
                    }       
                } else {
                    $('.body').css({'height':'auto', 'max-width':'400px'});
                    $('#widget_container_caption').html('');
                    $('#widget_container').html('<p><i>This is a non-displaying widget.</i></p>');
                }
 
            SYSTO.trigger({
                file:' widget_presenter.html',
                action: 'page loading',
                event_type: 'change_model_listener',
                parameters: {packageId:'package1', oldModelId:'',newModelId:'miniworld'}});
            SYSTO.trigger({
                file: 'widget_presenter.html',
                action: 'page loading',
                event_type: 'display_listener',
                parameters: {packageId:'package1', modelId:'miniworld'}});

                if (meta.long_description) {
                    $('#widget_display').append(meta.long_description);
                }

                if (meta.listeners) {
                    var html = '<h3>Event listeners</h3><ul>';
                    for (var i=0; i<meta.listeners.length; i++) {
                        html += '<li><a href="documentation/pubsub/'+meta.listeners[i]+'.html">'+meta.listeners[i]+'</a>';
                        html += '</li>';
                    }
                    html += '</ul>';
                    $('#widget_display').append(html);
                }

                if (widget._proto.options) {
                    $('#widget_display').append('<h3>Options</h3>');
                    var options = widget._proto.options;
                    if (widget._proto.meta) {
                        if (meta.options) {
                            var optionsInfo = meta.options;
                        } 
                    } else {
                        optionsInfo = {};
                    }    
                    //$('#widget_display').append(
                    //    '<table id="widget_display_options_table"></table>');
                    $('#widget_display').append('<div id="widget_display_options_div"></div>');
                    for (var optionId in options) {
                        if (options.hasOwnProperty(optionId)) {
                            if (!optionsInfo[optionId]) {
                                optionsInfo[optionId] = {};
                            }
    /*
                            $('#widget_display_options_table').append(
                                '<tr>'+
                                    '<td>'+optionId+'</td>'+
                                    '<td>'+optionsInfo[optionId].description+'</td>'+
                                    '<td>'+optionsInfo[optionId].type+'</td>'+
                                    '<td>'+optionsInfo[optionId].default+'</td>'+
                                '</tr>');
    */
                            $('#widget_display_options_div').append(
                                '<span class="optionId">'+optionId+'</span><br/>'+
                                '<span>'+optionsInfo[optionId].description+'</span><br/>'+
                                'Type: '+optionsInfo[optionId].type+'<br/>'+
                                'Default: '+optionsInfo[optionId].default+'<br/><br/>');
                                
                        }
                    }
                } else {
                    $('#widget.display_options_table').append('No options');
                }
            } else {
                $('#widget_display').append('<p>No infromation has been provided for this widget.</p>');
            }
    }
</script>

</body>
</html>
